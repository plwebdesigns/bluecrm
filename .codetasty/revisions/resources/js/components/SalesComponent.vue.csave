codetasty.revision.2.0
{"ts":1614782414,"restoring":false,"user_id":44265,"patch":[{"diffs":[[1,"<template>\n  <div>\n    <nav-component :isAdmin=\"user.isAdmin\"></nav-component>\n    <div class=\"container justify-content-center increased-width\">\n      <div class=\"row\">\n        <profile-component></profile-component>\n        <div class=\"col\">\n          <div class=\"row pb-2\">\n            <div class=\"col-4\">\n              <h5\n                class=\"font-fredricka text-left\"\n              >{{user.agent_name + \" \" + this.production_year}} Production</h5>\n            </div>\n            <div class=\"col-5\">\n              <search-component v-on:search=\"searchProduction($event)\"></search-component>\n            </div>\n            <div class=\"col-3 justify-content-end\">\n                <SelectYearComponent v-on:production_year=\"changeYear($event)\"></SelectYearComponent>\n            </div>\n          </div>\n          <table class=\"table table-sm table-hover\">\n            <thead>\n              <tr class=\"bg-blue-realty\">\n                <th>CLOSING DATE</th>\n                <th>CLIENT NAME</th>\n                <th>SALE PRICE</th>\n                <th>TYPE</th>\n                <th>COMMISSION</th>\n                <th>SPLIT</th>\n              </tr>\n            </thead>\n            <tbody>\n              <tr v-for=\"(sale, index) in formattedSales\" v-on:click=\"show(sale)\" :key=\"index\">\n                <td>{{sale.closing_date}}</td>\n                <td>{{sale.client_name}}</td>\n                <td>{{sale.sale_price}}</td>\n                <td>{{sale.type}}</td>\n                <td>{{sale.pivot.commission}}</td>\n                <td>{{sale.pivot.split}}%</td>\n              </tr>\n              <tr style=\"border-top: solid 2px black; font-weight: bolder\">\n                <td>TOTALS</td>\n                <td></td>\n                <td>{{user.ytd_sales.toLocaleString('en-US', numberFormat)}}</td>\n                <td></td>\n                <td>{{user.ytd_commission.toLocaleString('en-US', numberFormat)}}</td>\n                <td></td>\n              </tr>\n            </tbody>\n          </table>\n          <h5 class=\"font-fredricka text-left\">{{user.agent_name}} Split Sales</h5>\n          <table class=\"table table-sm table-hover\">\n            <thead>\n              <tr class=\"bg-blue-realty\">\n                <th>CLOSING DATE</th>\n                <th>CLIENT NAME</th>\n                <th>SALE PRICE</th>\n                <th>TYPE</th>\n                <th>COMMISSION</th>\n                <th>SPLIT</th>\n              </tr>\n            </thead>\n            <tbody>\n              <tr\n                v-for=\"(team_sale, index) in formattedSplitSales\"\n                v-on:click=\"show(team_sale)\"\n                :key=\"index\"\n              >\n                <td>{{team_sale.closing_date}}</td>\n                <td>{{team_sale.client_name}}</td>\n                <td>{{team_sale.sale_price}}</td>\n                <td>{{team_sale.type}}</td>\n                <td>{{team_sale.pivot.commission}}</td>\n                <td>{{team_sale.pivot.split}}%</td>\n              </tr>\n              <tr style=\"border-top: solid 2px black; font-weight: bolder\">\n                <td>TOTALS</td>\n                <td></td>\n                <td>{{ (user.ytd_split_sales > 0) ? user.ytd_split_sales.toLocaleString('en-US', numberFormat) : \" \"}}</td>\n                <td></td>\n                <td>{{user.ytd_split_commission.toLocaleString('en-US', numberFormat)}}</td>\n                <td></td>\n              </tr>\n            </tbody>\n          </table>\n        </div>\n      </div>\n      <div class=\"row\">\n        <div class=\"col\">\n          <quarter-breakdown :production_yr=\"production_year\" :key=\"production_year\"></quarter-breakdown>\n        </div>\n      </div>\n    </div>\n    <admin-sale></admin-sale>\n    <change-pass-component></change-pass-component>\n  </div>\n</template>\n\n<script>\nimport ChangePass from \"./ChangePassComponent\";\nimport quarterBreakdown from \"./QuarterBreakdown\";\nimport SelectYearComponent from \"./SelectYearComponent\";\n\nexport default {\n  components: {\n    changePassComponent: ChangePass,\n    quarterBreakdown: quarterBreakdown,\n      SelectYearComponent: SelectYearComponent\n  },\n  mounted() {\n    this.getSales();\n  },\n  props: {\n    production_yr: \"\",\n  },\n  data() {\n    return {\n      sales: {\n        closing_date: \"\",\n        agent_name: \"\",\n        client_name: \"\",\n        sale_price: \"\",\n        type: \"\",\n        pivot: {\n          commission: \"\",\n          split: \"\",\n        },\n      },\n      team_sales: {\n        closing_date: \"\",\n        agent_name: \"\",\n        client_name: \"\",\n        sale_price: \"\",\n        type: \"\",\n        pivot: {\n          commission: \"\",\n          split: \"\",\n        },\n      },\n      user: {\n        isAdmin: false,\n        agent_name: \"\",\n        ytd_sales: 0,\n        ytd_commission: 0,\n        ytd_split_commission: 0,\n        ytd_split_sales: 0,\n      },\n      numberFormat: {\n        maximumFractionDigits: 2,\n        minimumFractionDigits: 2,\n        style: \"currency\",\n        currency: \"USD\",\n      },\n      production_year: new Date().getFullYear(),\n    };\n  },\n  methods: {\n    getSales() {\n      let token = this.getCookie(\"token\");\n\n      let req = {};\n\n      req = {\n        method: \"get\",\n        url: \"/api/sales\",\n        headers: {\n          Accept: \"application/json\",\n          Authorization: \"Bearer \" + token,\n        },\n        params: {\n          production_year: this.production_year,\n        },\n      };\n\n      axios(req)\n        .then((resp) => {\n          this.sales = resp.data.sales;\n          this.user.isAdmin = resp.data.req.isAdmin;\n          this.user.agent_name = resp.data.req.agent_name;\n          this.user.ytd_sales = resp.data.ytd_sales;\n          this.user.ytd_commission = resp.data.ytd_commission;\n          this.user.ytd_split_commission = resp.data.ytd_split_commission;\n          this.user.ytd_split_sales = resp.data.ytd_split_sales;\n          this.team_sales = resp.data.team_sales;\n        })\n        .catch(function (error) {\n          if (error.response.status === 401) {\n            window.location = \"/login\";\n          }\n          console.log(error);\n        });\n    },\n    getCookie(cname) {\n      var name = cname + \"=\";\n      var decodedCookie = decodeURIComponent(document.cookie);\n      var ca = decodedCookie.split(\";\");\n      for (var i = 0; i < ca.length; i++) {\n        var c = ca[i];\n        while (c.charAt(0) == \" \") {\n          c = c.substring(1);\n        }\n        if (c.indexOf(name) == 0) {\n          return c.substring(name.length, c.length);\n        }\n      }\n      return \"\";\n    },\n    show(sale) {\n      this.$modal.show(\"adminSales\", {\n        data: sale,\n      });\n    },\n    changeYear(year) {\n      // this.production_year = document.getElementById(\"production_year\").value;\n      let token = this.getCookie(\"token\");\n\n      let request = {\n        method: \"GET\",\n        url: \"/api/sales\",\n        headers: {\n          Accept: \"application/json\",\n          Authorization: \"Bearer \" + token,\n        },\n        params: {\n          production_year: year\n        },\n      };\n\n      axios(request).then((resp) => {\n        this.sales = resp.data.sales;\n        this.user.isAdmin = resp.data.req.isAdmin;\n        this.user.agent_name = resp.data.req.agent_name;\n        this.user.ytd_sales = resp.data.ytd_sales;\n        this.user.ytd_commission = resp.data.ytd_commission;\n        this.user.ytd_split_commission = resp.data.ytd_split_commission;\n        this.user.ytd_split_sales = resp.data.ytd_split_sales;\n        this.team_sales = resp.data.team_sales;\n      });\n    },\n    searchProduction: function (s) {\n      let search_term = s.term;\n      let token = this.getCookie(\"token\");\n\n      $.ajax({\n        type: \"post\",\n        url: \"/api/search_production\",\n        headers: {\n          Accept: \"application/json\",\n          Authorization: \"Bearer \" + token,\n        },\n        data: {\n          term: search_term,\n          production_year: this.production_year,\n        },\n      }).done((resp) => {\n        this.sales = resp.sales;\n        this.team_sales = resp.split_sales;\n      });\n    },\n  },\n  computed: {\n    formattedSales: function () {\n      let sales = [];\n      for (const salesKey in this.sales) {\n        let sale = this.sales[salesKey];\n        sale.closing_date = new Date(sale.closing_date).toLocaleDateString();\n        sale.sale_price = Number(sale.sale_price).toLocaleString(\n          \"en-US\",\n          this.numberFormat\n        );\n        sale.pivot.commission = Number(sale.pivot.commission).toLocaleString(\n          \"en-US\",\n          this.numberFormat\n        );\n        sale.pivot.split = sale.pivot.split * 100;\n        sales.push(sale);\n      }\n      sales.sort(function (a, b) {\n        return new Date(a.closing_date) - new Date(b.closing_date);\n      });\n\n      return sales;\n    },\n    formattedSplitSales: function () {\n      let sales = [];\n      for (const salesKey in this.team_sales) {\n        let sale = this.team_sales[salesKey];\n        sale.closing_date = new Date(sale.closing_date).toLocaleDateString();\n        sale.sale_price = Number(sale.sale_price).toLocaleString(\n          \"en-US\",\n          this.numberFormat\n        );\n        sale.pivot.commission = Number(sale.pivot.commission).toLocaleString(\n          \"en-US\",\n          this.numberFormat\n        );\n        sale.pivot.split = sale.pivot.split * 100;\n        sales.push(sale);\n      }\n\n      sales.sort(function (a, b) {\n        return new Date(a.closing_date) - new Date(b.closing_date);\n      });\n\n      return sales;\n    },\n  },\n};\n</script>\n"]],"start1":0,"start2":0,"length1":0,"length2":9481}],"length":9481}
{"ts":1614782883,"restoring":false,"user_id":44265,"patch":[{"diffs":[[0," === 401"],[1," || error.response.status === 404"],[0,") {\n    "]],"start1":5955,"start2":5955,"length1":16,"length2":49}],"length":9514}